<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="base::Layout(~{::section})">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css}" rel="stylesheet" />
	<script th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js}"></script>
	<title>Driver</title>
	<link th:href="@{/styles.css}" rel="stylesheet" />
</head>

<body>
	<section>

		<style>
			@media screen and (max-width: 815px) {
				#TopMobile {
					margin-left: 250px !important;
					/* Using !important to override existing styles if needed */
				}
			}
		</style>


	<!--  Main wrapper -->
		<div class="body-wrapper ms-3 mt-2 " style="background-color:var(--bs-gray-200);">

			<div class="row " th:if="${visitorToken}" style="width:1100px;">
				<table class="text-black bg-white table-bordered ms-3 mt-2" id="pass">
					<tr class="text-center  ">
						<th class="p-2"><img th:src="@{/img/{imageName}(imageName=${visitorToken.imageName})}"
								alt="Visitor Image" height="200" width="200"></th>
						<th colspan="3">
							<h3> Hindustan Petroleum Corporation Limited <br>
								Sinnar LPG Bottling Plant, G-6, M.I.D.C., Malegaon, Sinnar, Nashik- 422113.
							</h3>
						</th>	
						<th class="p-2">
							<img id="image1"
								th:src="@{/generateQRCode(data=${visitorToken.qr})}"
								class="ms-4" width="200" height="200" alt="QR Code" />
						</th>
					</tr>
					<tr class="text-center ">
						<th colspan="5">
							<h2> VISITOR SLIP </h2>
						</th>
					</tr>
					<tr class="text-center ">
						<td colspan="5" class="text-center"> TOKEN NO: <span th:text="${visitorToken.visitorId}"></span>
						</td>

					</tr>
					<tr class="text-start ">
						<td class="ps-2"> Sr No : </td>
						<!-- <td class="ps-2" th:text="${visitorToken.c}"> </td>-->
						<td class="ps-2" th:text="${visitorToken.currSrNo}"></td>
						<td class="ps-2"></td>
						<td class="ps-2"> TIME IN : </td>
						<td class="ps-2"> </td>
					</tr>
					<tr>
						<td class="ps-2"> DATE: </td>
						<td class="ps-2" th:text="${visitorToken.date}"> </td>
						<td class="text-center"> </td>
						<td class="ps-2"> TIME OUT: </td>
						<td class="ps-2"> </td>
					</tr>
					<tr>
						<td class="ps-2"> Aadhar Number of Visitor : </td>
						<td class="ps-2"> <span th:text="${visitorToken.aadharNumber}"></span></td>
						<td class="ps-2"> </td>
						<td class="ps-2"> MOBILE NO : </td>
						<td class="ps-2"> <span th:text="${visitorToken.mobileNumber}"> </span></td>
					</tr>
					<tr>
						<td class="ps-2"> Name of the Visitor : </td>
						<td class="ps-2" colspan="4"><span th:text="${visitorToken.fullName}"> </span></td>
					</tr>
					<tr>
						<td class="ps-2"> Company / Resclassential Address : </td>
						<td class="ps-2" colspan="4"> <span th:text="${visitorToken.address}"></span> </td>
					</tr>
					<tr>
						<td class="ps-2"> To see whom : </td>
						<td class="ps-2"> <span th:text="${visitorToken.whom}"></span> </td>
						<td class="ps-2"></td>
						<td class="ps-2">Purpose :</td>
						<td class="ps-2" colspan="4"> <span th:text="${visitorToken.purpose}"></span></td>
					</tr>

					<tr>
						<td class="px-2"> Description of material if carried : </td>
						<td class="ps-2" colspan="4"> </td>
					</tr>
					<tr height="120">
						<td colspan="2" class="ps-2 pb-3" style="vertical-align: bottom; text-align: center;"> Signature
							of Visitor </td>
						<td class="ps-2"> </td>
						<td colspan="2" class="ps-2 pb-3" style="vertical-align: bottom; text-align: center;"> Signature
							of security </td>
					</tr>
					<tr>
						<td class="px-2 py-2 text-center" colspan="5"> FOR ENTRY INTO LICENSED AREA </td>
					</tr>
					<tr>
						<td class="px-2"> Permitted to go to : </td>
						<td class="ps-2"> </td>
						<td class="ps-2"> </td>
						<td class="ps-2"> Authorised by: </td>
						<td class="ps-2"> </td>
					</tr>

					<td colspan="5" class="ps-2 py-3">
						1. Visitors are requested not to carry match box, light, camera, Torch light or any other
						Flamming article insclasse the main gate. If any, the same may be deposited with the security.
						</tr>
					<td colspan="5" class="ps-2 py-3">
						2. Please park your vehicles at outsclasse only at your own risk. Company is not responsible.
					</td>
					</tr>

				</table>
			</div>

		</div>



<!--		<div th:if="${visitorToken}">-->
<!--			<h1>Gate Pass Details</h1>-->
<!--			<p><strong>Token ID:</strong> <span th:text="${visitorToken.id}"></span></p>-->
<!--			<p><strong>Visitor ID:</strong> <span th:text="${visitorToken.visitorId}"></span></p>-->
<!--			<p><strong>Aadhar Number:</strong> <span th:text="${visitorToken.aadharNumber}"></span></p>-->
<!--			<p><strong>Full Name:</strong> <span th:text="${visitorToken.fullName}"></span></p>-->
<!--			<p><strong>Mobile Number:</strong> <span th:text="${visitorToken.mobileNumber}"></span></p>-->
<!--			<p><strong>Address:</strong> <span th:text="${visitorToken.address}"></span></p>-->
<!--			<p><strong>Whom to Meet:</strong> <span th:text="${visitorToken.whom}"></span></p>-->
<!--			<p><strong>Purpose:</strong> <span th:text="${visitorToken.purpose}"></span></p>-->
<!--			<p><strong>Date:</strong> <span th:text="${visitorToken.date}"></span></p>-->
<!--			<p><strong>QR:</strong> <span th:text="${visitorToken.qr}"></span></p>-->
<!--			<p>-->
<!--				<img id="image1" th:src="@{/generateQRCode(data=${visitorToken.qr})}" class="ms-4" width="200"-->
<!--					height="200" alt="QR Code" />-->
<!--			</p>-->
<!--			<p class="p-2"><img th:src="@{/img/{imageName}(imageName=${visitorToken.imageName})}" alt="Visitor Image"-->
<!--					height="200" width="200"></p>-->

<!--		</div>-->
		<div th:if="${errorMessage}">
			<p style="color: red;" th:text="${errorMessage}"></p>
		</div>
		<a href="/visitor">Back to Visitor Page</a>
	</section>
</body>

</html>

<script th:src="@{https://code.jquery.com/jquery-3.6.0.min.js}"></script>
<script th:inline="javascript">
	var visitorData = [];
	var currentCount = 0;

	function addVisitor() {
		visitorData = [];
		var visitorCount = parseInt(document.getElementById('visitor_count').value);
		var visitorFields = document.getElementById('visitor_fields'); // Correct the element id

		for (var i = 1; i <= visitorCount; i++) {
			currentCount++;
			var visitorText = document.createElement('p');
			visitorText.textContent = currentCount;
			visitorFields.appendChild(visitorText);
			visitorData.push(currentCount);
		}

		console.log(visitorData);
		submitVisitor(visitorData);
	}

	function submitVisitor(visitorData) {
		var xhr = new XMLHttpRequest();
		var url = '/submitVisitor';
		xhr.open('POST', url, true);
		xhr.setRequestHeader('Content-Type', 'application/json');

		xhr.onreadystatechange = function () {
			if (xhr.readyState === 4) {
				if (xhr.status === 200) {
					var response = JSON.parse(xhr.responseText);
					var pop = "Success";
					alert(pop);
					location.reload();

					setTimeout(function () {
						location.reload();
					}, 1000);
				} else {
					// Handle errors here
					var errorMessage = "Error occurred while submitting Sec data.";
					alert(errorMessage);
				}
			}
		};

		xhr.send(JSON.stringify(visitorData));
	}
</script>
<!-- Bootstrap JavaScript & Popper.js (Include this in your HTML before closing </body>) -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>